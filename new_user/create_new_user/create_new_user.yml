---
- name: Create new user in Develop host
  hosts: remote-server
  gather_facts: no
  vars:
    - shell: /usr/bin/lshell
    - comment: "User is generated by Ansible and Limit Shell"
    - lshell_group: developer
  vars_prompt:
    - name: user
      prompt: "Which is new-user ?"
    
    - name: home_path
      prompt: "Which is var path ?"

    - name: pub_key
      prompt: "Where is pub key?" 

  tasks:
    - name: Step 01 - Create new user
      user: 
        name: "{{ user }}"
        group: "{{ lshell_group }}"
        shell: "{{ shell }}"
        comment: "{{ comment }}"
      become: yes
      register: step_01

    - name: Step 02 - Add ssh key
      authorized_key: 
        user: "{{ user }}" 
        key: "{{ item }}"
      with_file:
        - "{{ pub_key }}"
      become: yes
      register: step_02
      when: step_01|success
